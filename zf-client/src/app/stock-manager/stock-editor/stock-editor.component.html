<div fxLayout="column" *ngIf="stock" fxLayoutGap="10px">
  <div fxLayout="column">

    <!--------------- Title and menu --------------------->
    <mat-toolbar class="zf-mini-toolbar">{{title}}</mat-toolbar>

    <form #stockEditForm="ngForm">
      <!-- Editor form has two sets of fields. Put them side by side on larger screens and in a -->
      <!-- column on smaller ones. -->
      <div [fxLayout]="(appState.screenSize > ScreenSizes.SMALL) ? 'row' : 'column'" fxLayoutGap="20px">

        <!-- First group of fields pertain to the stock itself -->
        <div fxFlex="50" fxLayout="column">
          <mat-form-field>
            <input matInput type="text" placeholder="Stock Number" name="sn" [(ngModel)]="stock.name" disabled>
          </mat-form-field>
          <mat-form-field>
            <input matInput type="text" placeholder="Description" name="desc" [(ngModel)]="stock.description" required
                   maxlength="100">
          </mat-form-field>
          <mat-form-field >
            <input matInput [matDatepicker]="picker" placeholder="Fertilization Date" name="fertDate"
            [(ngModel)]="stock.fertilizationDate" [disabled]="stock.nextSubStockNumber > 1" required>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
          <mat-form-field *ngIf="!appState.getState('hidePI')">
            <input matInput type="text" placeholder="Primary Investigator" (keyup)="onPIChange()" name="pi"
                   [(ngModel)]="stock.pi" [matAutocomplete]="autoPI"
                   maxlength="25">
          </mat-form-field>
          <mat-form-field>
            <input matInput type="text" placeholder="Researcher" (keyup)="onResearcherChange()" name="researcher"
                   [(ngModel)]="stock.researcher" [matAutocomplete]="autoResearcher"
                   maxlength="20">
          </mat-form-field>
          <mat-form-field>
        <textarea matInput placeholder="Comment" name="comment"
                  maxlength="4000"
                  [(ngModel)]="stock.comment"
                  cdkTextareaAutosize="true" cdkAutosizeMaxRows="7"></textarea>
          </mat-form-field>
        </div>

        <mat-divider vertical fxHide.lt-sm></mat-divider>
        <!-- The second group identifies the stock's parents -->
        <div class="zf-full-width" fxLayout="column">
          <!--  Mother --------------------------------------->
          <span class="zf-sub-title">Mom</span>
            <mat-radio-group [(ngModel)]="momInternal" color="primary" name="mom"
                             [disabled]="!stock.parentsEditable">
              <mat-radio-button class="zf-radio-button" [value]=true>Internal</mat-radio-button>
              <mat-radio-button class="zf-radio-button" [value]=false>External</mat-radio-button>
            </mat-radio-group>
          <div *ngIf="momInternal" fxLayout="column">
            <mat-form-field>
              <input matInput placeholder="Stock Number"
                     (keyup)="onSetMatStock()"
                     name="matStockNameF" #matStockNameF="ngModel" stockNameCheck
                     [(ngModel)]="stock.matStock.name" [disabled]="!stock.parentsEditable">
              <mat-error *ngIf="matStockNameF.errors">Stock name does not exist</mat-error>
            </mat-form-field>
            <mat-form-field>
              <input matInput type="text" placeholder="Description" name="msd"
                     [(ngModel)]="stock.matStock.description" disabled>
            </mat-form-field>
          </div>
          <div *ngIf="!momInternal" fxLayout="column">
            <mat-form-field>
              <input matInput name="extMomId" placeholder="External Identifier" type="text"
                     [(ngModel)]="stock.externalMatId" [disabled]="!stock.parentsEditable"
                     maxlength="20">
            </mat-form-field>
            <mat-form-field>
              <input matInput name="extMomDesc" placeholder="Description" type="text"
                     [(ngModel)]="stock.externalMatDescription" [disabled]="!stock.parentsEditable"
                     maxlength="40">
            </mat-form-field>
          </div>

          <!--  Father --------------------------------------->
            <span class="zf-sub-title">Dad</span>
            <mat-radio-group [(ngModel)]="dadInternal" color="primary" name="dad"
                             [disabled]="!stock.parentsEditable">
              <mat-radio-button class="zf-radio-button" [value]=true>Internal</mat-radio-button>
              <mat-radio-button class="zf-radio-button" [value]=false>External</mat-radio-button>
            </mat-radio-group>
          <div *ngIf="dadInternal"  fxLayout="column">
            <mat-form-field>
              <input matInput placeholder="Stock Number"
                     name="patStockNameF" #patStockNameF="ngModel" stockNameCheck
                     (keyup)="onSetPatStock()"
                     [(ngModel)]="stock.patStock.name" [disabled]="!stock.parentsEditable">
              <mat-error *ngIf="patStockNameF.errors">Stock name does not exist</mat-error>
            </mat-form-field>
            <mat-form-field>
              <input matInput placeholder="Description" name="psd"
                     [(ngModel)]="stock.patStock.description" disabled>
            </mat-form-field>
          </div>
          <div *ngIf="!dadInternal" fxLayout="column">
            <mat-form-field>
              <input matInput name="extPatId" placeholder="External Identifier" type="text"
                     [(ngModel)]="stock.externalPatId" [disabled]="!stock.parentsEditable"
                     maxlength="20">
            </mat-form-field>
            <mat-form-field>
              <input matInput name="extMatId" placeholder="Description" type="text"
                     [(ngModel)]="stock.externalPatDescription" [disabled]="!stock.parentsEditable"
                     maxlength="40">
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="fill-remaining-space"></div>
      <div fxLayout="row" fxLayoutGap="20px">
        <div class="fill-remaining-space"></div>
        <button mat-button color="primary" (click)="cancel()">Cancel</button>
        <button mat-button color="primary" [disabled]="isUnchanged()" (click)="revert()">Revert</button>
        <button (click)="save()" [disabled]="isUnchanged() || !stockEditForm.valid" color="primary" mat-button>Save
        </button>
      </div>
    </form>
  </div>
</div>

<mat-autocomplete #autoResearcher="matAutocomplete">
  <mat-option *ngFor="let option of filteredResearcherOptions" [value]="option">
    {{option}}
  </mat-option>
</mat-autocomplete>

<mat-autocomplete #autoPI="matAutocomplete">
  <mat-option *ngFor="let option of filteredPIOptions" [value]="option">
    {{option}}
  </mat-option>
</mat-autocomplete>
