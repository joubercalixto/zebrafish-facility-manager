<!-- The selector is quite different on the phone and on a big screen. -->

<!-- Filtered List Item
     Big Screen - mouse over shows more content about the item
     Phone - no mouse over.  So we try this.  If the user clicks
      once (touches), the item gets "pre-selected".  More info is displayed
      and a button comes up to let the user actually select the item.
      When "actually" selected, the whole selector toggles away and
      the selected item is viewed. -->

<div fxFlex fxLayout="column" class="zf-selector">

  <!-- The Filter part  -->
  <span class="zf-sub-title">Mutation Filter</span>
  <form [formGroup]="mfForm">


    <div fxLayout="row" fxLayoutAlign="space-between center">
      <mat-checkbox formControlName="ownedMutationsOnly" color="primary">Owned mutations only</mat-checkbox>
      <span class="fill-remaining-space"></span>
      <button mat-button color="accent" (click)="onClearFilters()" color="primary">Clear Filters</button>
    </div>

    <div fxLayout="row" fxLayout.lt-md="column">

      <div fxLayout="column" fxFlex="50%">

        <!--  First group of filter fields-->
        <mat-form-field>
          <input matInput type="text" placeholder="Search" formControlName="freeText">
          <button mat-button matSuffix mat-icon-button *ngIf="mfForm.get('freeText').value"
                  (click)="mfForm.get('freeText').setValue('')"><mat-icon>close</mat-icon></button>
        </mat-form-field>

        <mat-form-field >
          <input matInput type="text" placeholder="Researcher" formControlName="researcher" [matAutocomplete]="autoResearcher">
          <button mat-button matSuffix mat-icon-button *ngIf="mfForm.get('researcher').value"
                  (click)="mfForm.get('researcher').setValue('')"><mat-icon>close</mat-icon></button>
        </mat-form-field>

        <mat-form-field >
          <input matInput type="text" placeholder="Mutation Type" formControlName="mutationType" [matAutocomplete]="autoMT">
          <button mat-button matSuffix mat-icon-button *ngIf="mfForm.get('mutationType').value"
                  (click)="mfForm.get('mutationType').setValue('')"><mat-icon>close</mat-icon></button>
        </mat-form-field>
      </div>


      <!-- Second group of filter fields -->
      <div fxLayout="column" fxFlex="50%">
        <mat-form-field >
          <input matInput type="text" placeholder="Gene" formControlName="gene" [matAutocomplete]="autoGene">
          <button mat-button matSuffix mat-icon-button *ngIf="mfForm.get('gene').value"
                  (click)="clearFormControl('gene')"><mat-icon>close</mat-icon></button>
        </mat-form-field>

        <mat-form-field >
          <input [matAutocomplete]="autoST" formControlName="screenType" matInput placeholder="Generated By"
                 type="text">
          <button mat-button matSuffix mat-icon-button *ngIf="mfForm.get('screenType').value"
                  (click)="mfForm.get('screenType').setValue('')"><mat-icon>close</mat-icon></button>
        </mat-form-field>

        <mat-form-field>
          <mat-select placeholder="Sperm Freeze State" formControlName="spermFreeze">
            <mat-option [value]=null>--Any--</mat-option>
            <mat-option *ngFor="let i of service.spermFreezeOptions" [value]="i">{{i}}</mat-option>
          </mat-select>
        </mat-form-field>

      </div>
    </div>
  </form>

  <!-- The filtered List part -->
  <div *ngIf="service.filteredList.length > 0" >
    <span class="zf-sub-title">Filtered List</span>

    <!-- When the selector is fixed in place -->
    <div *ngIf="appState.selectorFixed">
      <mat-list role="list"  dense>
        <mat-list-item style="height: fit-content"
          *ngFor="let item of service.filteredList"
          [class.selected]="service.selected && item.id === service.selected.id"
          class="zf-selection-item zf-list-item truncate" role="listitem"
          (click)="onSelect(item)">
            <app-mutation-mini-viewer mat-line [mutation]="item"></app-mutation-mini-viewer>
        </mat-list-item>
      </mat-list>
    </div>

    <!-- When the selector is togglebale (on a handset)-->
    <div *ngIf="!appState.selectorFixed">
      <mat-list role="list" dense>
        <mat-list-item
          *ngFor="let item of service.filteredList"
          [class.selected]="service.selected && item.id === service.selected.id"
          class="zf-selection-item truncate" role="listitem"
          (click)="onPreselect(item.id)">
          <button *ngIf="focusId === item.id" mat-mini-fab (click)="onSelect(item)" color="primary">
            <mat-icon>navigate_next</mat-icon>
          </button>

          <div mat-line *ngIf="item.id !== focusId">
            <div mat-line>{{item.fullName}}</div>
          </div>
          <div mat-line *ngIf="item.id === focusId">
            <app-mutation-mini-viewer mat-line [mutation]="item"></app-mutation-mini-viewer>
          </div>
        </mat-list-item>
      </mat-list>
    </div>

  </div>
  <div *ngIf="service.filteredList.length == 0">
    <p>No mutations match the current filter,</p>
    <p>try relaxing the filter criteria. </p>
  </div>
</div>

<!-- Auto completes grouped outside of main code for easier reading -->
<mat-autocomplete #autoGene="matAutocomplete">
  <mat-option *ngFor="let option of filteredGeneOptions | async" [value]="option">
    {{option}}
  </mat-option>
</mat-autocomplete>
<mat-autocomplete #autoResearcher="matAutocomplete">
  <mat-option *ngFor="let option of filteredResearcherOptions | async" [value]="option">
    {{option}}
  </mat-option>
</mat-autocomplete>
<mat-autocomplete #autoMT="matAutocomplete">
  <mat-option *ngFor="let option of filteredMutationTypeOptions | async" [value]="option">
    {{option}}
  </mat-option>
</mat-autocomplete>
<mat-autocomplete #autoST="matAutocomplete">
  <mat-option *ngFor="let option of filteredScreenTypeOptions | async" [value]="option">
    {{option}}
  </mat-option>
</mat-autocomplete>
