<div fxLayout="column" *ngIf="item">

  <mat-toolbar class="zf-mini-toolbar">
    <span class="zf-title">Mutation Editor</span>
  </mat-toolbar>

  <form [formGroup]="mfForm">
    <div [fxLayout]="(appState.screenSize > ScreenSizes.SMALL) ? 'row' : 'column'" fxLayoutGap="20px">

      <div fxLayout="column" fxFlex="30%">
        <mat-form-field>
          <label>
            <input [matAutocomplete]="autoGene" formControlName="gene" matInput maxlength="20"
                   placeholder="Gene"
                   type="text">
          </label>
        </mat-form-field>

        <mat-form-field>
          <label>
            <input formControlName="name" matInput maxlength="25" placeholder="Allele" required
                   type="text">
          </label>
          <mat-error *ngIf="nameControl.touched && nameControl.invalid">{{getNameError()}}</mat-error>
        </mat-form-field>

        <mat-form-field>
          <label>
            <input formControlName="nickname" matInput maxlength="30" placeholder="Nickname"
                   type="text">
          </label>
          <mat-error *ngIf="nicknameControl.touched && nicknameControl.invalid">{{getNicknameError()}}</mat-error>
          <mat-hint>Used for printing compact labels</mat-hint>
        </mat-form-field>

        <mat-form-field>
          <label>
            <input formControlName="alternateGeneName" matInput maxlength="100"
                   placeholder="Alternate Gene Name">
          </label>
        </mat-form-field>

        <mat-form-field>
          <label>
            <input [matAutocomplete]="autoResearcher" formControlName="researcher" matInput maxlength="20"
                   placeholder="Source"
                   required
                   type="text">
          </label>
        </mat-form-field>

        <mat-form-field>
          <mat-select formControlName="mutationType" placeholder="Mutation Type">
            <mat-select-trigger>
              {{mfForm.controls['mutationType'].value}}
            </mat-select-trigger>
            <mat-option *ngFor="let option of service.mutationTypes" [value]="option.name">
              <div>{{option.name}} ({{option.abbrv}})</div>
              <div class="option-detail">{{option.description}}</div>
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <label>
            <input formControlName="actgChange" matInput maxlength="10"
                   placeholder="Nucleotide Change">
          </label>
          <mat-hint *ngIf="getControl('actgChange').dirty">A2345G for example.</mat-hint>
        </mat-form-field>

        <mat-form-field>
          <label>
            <input formControlName="aaChange" matInput maxlength="10"
                   placeholder="Amino Acid Change">
          </label>
          <mat-hint *ngIf="getControl('aaChange').dirty">A316V for example.</mat-hint>
        </mat-form-field>

        <mat-form-field>
          <mat-select formControlName="screenType" placeholder="Generated By">
            <mat-select-trigger>
              {{mfForm.controls['screenType'].value}}
            </mat-select-trigger>
            <mat-option *ngFor="let option of service.screenTypes" [value]="option.name">
              <div>{{option.name}}</div>
              <div class="option-detail">{{option.description}}</div>
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <mat-select placeholder="Sperm Freeze Plan" formControlName="spermFreezePlan">
            <mat-option [value]=null>--Any--</mat-option>
            <mat-option *ngFor="let i of spermFreezeOptions" [value]="i">{{i}}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <label>
            <input formControlName="vialsFrozen" matInput min="0" placeholder="Vials Frozen"
                   type="number">
          </label>
        </mat-form-field>
      </div>

      <div fxLayout="column" fxLayoutGap="20px" fxFlex>
        <mat-form-field>
          <label>
            <textarea cdkAutosizeMaxRows="7" cdkTextareaAutosize="true" formControlName="comment"
                      matInput maxlength="3000" placeholder="Comment"></textarea>
          </label>
        </mat-form-field>

        <mat-form-field>
          <label>
            <textarea cdkAutosizeMaxRows="3" cdkTextareaAutosize="true" formControlName="zfinURL"
                      matInput maxlength="255" placeholder="ZFIN URL"></textarea>
          </label>
          <mat-error *ngIf="zfinURLControl.touched && zfinURLControl.invalid">{{getZfinURLError()}}</mat-error>
        </mat-form-field>

        <mat-form-field>
          <label>
            <textarea cdkAutosizeMaxRows="7" cdkTextareaAutosize="true" formControlName="phenotype"
                      matInput maxlength="3000" placeholder="Phenotype"></textarea>
          </label>
        </mat-form-field>
        <mat-form-field>
          <label>
            <textarea cdkAutosizeMaxRows="7" cdkTextareaAutosize="true" formControlName="morphantPhenotype"
                      matInput maxlength="3000" placeholder="Morphant Phenotype"></textarea>
          </label>
        </mat-form-field>
        <div class="fill-remaining-space"></div>
        <div fxLayout="row" fxLayoutGap="20px">
          <div class="fill-remaining-space"></div>
        </div>

      </div>
    </div>
  </form>
  <div fxLayout="row" fxLayoutGap="10px">
    <div class="fill-remaining-space"></div>
    <button mat-button color="primary" (click)="cancel()">Cancel</button>
    <button mat-button color="primary" [disabled]='mfForm.pristine' (click)="revert()">Revert</button>
    <button mat-button color="primary" [disabled]='!mfForm.valid || mfForm.pristine' (click)="save()">Save</button>
  </div>
</div>

<!-- All the auto-completes gathered together to make the form easier to read. -->
<mat-autocomplete #autoGene="matAutocomplete">
  <mat-option *ngFor="let option of filteredGeneOptions | async" [value]="option">
    {{option}}
  </mat-option>
</mat-autocomplete>

<mat-autocomplete #autoResearcher="matAutocomplete">
  <mat-option *ngFor="let option of filteredResearcherOptions | async" [value]="option">
    {{option}}
  </mat-option>
</mat-autocomplete>
